<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SDG Master Quiz Web</title>
    <style>
        :root {
            --bg-dark: #2D2D2D;
            --card-bg: #404040;
            --accent: #FFD700;
            --text-white: #ffffff;
            --correct-green: #4C9F38;
            --wrong-red: #E5243B;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            margin: 0;
            display: flex;
            justify-content: center;
            touch-action: manipulation;
        }

        #app-container {
            width: 100%;
            max-width: 450px;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        .screen { display: none; flex-direction: column; }
        .active { display: flex; }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }

        /* Men√º */
        .menu-btn {
            background-color: var(--card-bg);
            margin: 10px 0; padding: 18px;
            border-radius: 8px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Quiz UI */
        .sdg-display-box {
            width: 100%; height: 180px;
            display: flex; justify-content: center; align-items: center;
            border-radius: 12px; margin-bottom: 30px;
            font-size: 80px; font-weight: bold;
        }
        .sdg-display-box img { max-height: 140px; border-radius: 8px; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn {
            background-color: var(--card-bg); border: none; color: white;
            padding: 10px; border-radius: 6px; cursor: pointer; min-height: 90px;
            font-size: 13px; display: flex; align-items: center; justify-content: center;
            text-align: center; line-height: 1.2;
        }

        /* Drag & Drop */
        .drop-zone-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .drop-zone {
            background: var(--card-bg);
            min-height: 130px;
            border: 2px dashed #666;
            border-radius: 8px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 10px; font-size: 12px;
            transition: 0.3s; line-height: 1.3;
        }
        .drop-zone.filled { border-style: solid; border-color: transparent; }

        .drag-items {
            display: flex; justify-content: space-around;
            padding: 15px; background: #333; border-radius: 8px;
            min-height: 70px; margin-bottom: 20px;
        }
        .drag-box {
            width: 55px; height: 55px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 22px; color: white;
            border-radius: 8px; cursor: grab;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            touch-action: none;
        }

        .action-btn {
            background-color: var(--accent); color: black;
            border: none; padding: 15px; border-radius: 8px;
            font-weight: bold; cursor: pointer; font-size: 16px;
            margin-top: 10px; width: 100%;
        }

        /* Karteikarten */
        .flashcard {
            width: 100%; max-width: 300px; height: 400px; margin: 20px auto;
            background: white; color: black; border-radius: 15px;
            display: flex; justify-content: center; align-items: center;
            text-align: center; cursor: pointer; padding: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .flashcard img { border-radius: 10px; width: 280px; height: auto; }

        /* Tabelle / Liste (FIXED SIZE) */
        .list-row {
            display: flex; background: var(--card-bg);
            margin-bottom: 6px; align-items: center; border-radius: 4px; overflow: hidden;
        }
        .row-nr { width: 45px; height: 60px; display: flex; justify-content: center; align-items: center; font-weight: bold; flex-shrink: 0; }
        .row-img { width: 50px; height: 50px; margin: 0 10px; border-radius: 3px; flex-shrink: 0; object-fit: contain; }
        .row-text { font-size: 13px; padding-right: 10px; flex-grow: 1; }

        .correct { background-color: var(--correct-green) !important; color: white !important; }
        .wrong { background-color: var(--wrong-red) !important; color: white !important; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="menu-screen" class="screen active">
        <h1 style="text-align:center">SDG LERN-APP</h1>
        <div class="menu-btn" onclick="startQuiz(4)">Quiz (Einfach)</div>
        <div class="menu-btn" onclick="startQuiz(6)">Quiz (Schwer)</div>
        <div class="menu-btn" onclick="startQuiz(4,true)">1 Minute Challenge</div>
        <div class="menu-btn" onclick="startDragDrop()">Ziehen & Ablegen</div>
        <div class="menu-btn" onclick="startFlashcards()">Karteikarten</div>
        <div class="menu-btn" onclick="showTable()">Tabelle</div>
    </div>

<div id="quiz-screen" class="screen">
        <div class="top-bar">
            <button class="back-btn" onclick="showMenu()">‚Üê</button>
            <span id="lives-label" style="font-size:20px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
            <span id="timer-label"></span>
            <span id="score-label">Punkte: 0</span>
        </div>
        <div id="quiz-display" class="sdg-display-box"></div>
        <div id="quiz-options" class="options-grid"></div>
    </div>

    <div id="drag-screen" class="screen">
        <div class="top-bar"><button class="back-btn" onclick="showMenu()">‚Üê</button><span>Zuordnung pr√ºfen</span></div>
        <div id="drop-zones" class="drop-zone-container"></div>
        <div id="drag-pool" class="drag-items"></div>
        <button id="check-drag-btn" class="action-btn" onclick="checkDragAssignments()">√úberpr√ºfen</button>
        <button id="next-drag-btn" class="action-btn" style="display:none;" onclick="loadDrag()">N√§chste Runde</button>
    </div>

    <div id="flashcard-screen" class="screen">
        <div class="top-bar"><button class="back-btn" onclick="showMenu()">‚Üê</button><span id="card-progress"></span></div>
        <div id="main-card" class="flashcard" onclick="flipCard()"></div>
        <div style="display:flex; justify-content: space-around; margin-top: 20px;">
            <button class="option-btn" onclick="prevCard()" style="min-height: auto; width: 45%;">‚Üê</button>
            <button class="option-btn" onclick="nextCard()" style="min-height: auto; width: 45%;">‚Üí</button>
        </div>
    </div>

    <div id="table-screen" class="screen">
        <div class="top-bar"><button class="back-btn" onclick="showMenu()">‚Üê</button></div>
        <div id="table-content"></div>
    </div>
</div>

<script>
const SDGS = [
    {nr: 1, farbe: "#E5243B", titel: "Keine Armut"},
    {nr: 2, farbe: "#DDA63A", titel: "Kein Hunger"},
    {nr: 3, farbe: "#4C9F38", titel: "Gesundheit und Wohlergehen"},
    {nr: 4, farbe: "#C5192D", titel: "Hochwertige Bildung"},
    {nr: 5, farbe: "#FF3A21", titel: "Geschlechtergleichstellung"},
    {nr: 6, farbe: "#26BDE2", titel: "Sauberes Wasser und Sanit√§reinrichtungen"},
    {nr: 7, farbe: "#FCC30B", titel: "Bezahlbare und saubere Energie"},
    {nr: 8, farbe: "#A21942", titel: "Menschenw√ºrdige Arbeit und Wirtschaftswachstum"},
    {nr: 9, farbe: "#FD6925", titel: "Industrie, Innovation und Infrastruktur"},
    {nr: 10, farbe: "#DD1367", titel: "Weniger Ungleichheiten"},
    {nr: 11, farbe: "#FD9D24", titel: "Nachhaltige St√§dte und Gemeinden"},
    {nr: 12, farbe: "#BF8B2E", titel: "Nachhaltige/r Konsum und Produktion"},
    {nr: 13, farbe: "#3F7E44", titel: "Ma√ünahmen zum Klimaschutz"},
    {nr: 14, farbe: "#0A97D9", titel: "Leben unter Wasser"},
    {nr: 15, farbe: "#56C02B", titel: "Leben an Land"},
    {nr: 16, farbe: "#00689D", titel: "Frieden, Gerechtigkeit und starke Institutionen"},
    {nr: 17, farbe: "#19486A", titel: "Partnerschaften zur Erreichung der Ziele"}
];

let score=0, lives=3, timer=null, currentSdg=null, cardIdx=0, cardFront=true;
let currentDragData = [];

function getImgUrl(nr) {
    const padded = nr.toString().padStart(2, "0");
    return `https://commons.wikimedia.org/wiki/Special:Redirect/file/SDG-icon-DE-${padded}.svg`;
}

function showMenu(){
    clearInterval(timer);
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById("menu-screen").classList.add("active");
}

/* --- LEBENSANZEIGE UPDATE --- */
function updateLivesDisplay() {
    let hearts = "";
    for(let i=0; i<lives; i++) hearts += "‚ù§Ô∏è";
    for(let i=lives; i<3; i++) hearts += "üñ§"; // Optional: Leere Herzen anzeigen
    document.getElementById("lives-label").innerText = hearts;
}

/* --- QUIZ LOGIK (MIT HERZEN) --- */
function startQuiz(n, timed=false){
    score=0; 
    lives=3; // Start mit 3 Leben
    document.getElementById("score-label").innerText="Punkte: 0";
    updateLivesDisplay();

    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById("quiz-screen").classList.add("active");
    
    if(timed){
        let t=60; document.getElementById("timer-label").innerText=`Zeit: ${t}`;
        timer=setInterval(()=>{ t--; document.getElementById("timer-label").innerText=`Zeit: ${t}`;
        if(t<=0){ alert("Zeit abgelaufen!"); showMenu(); }},1000);
    } else document.getElementById("timer-label").innerText="";
    
    nextQuizQuestion(n);
}

function nextQuizQuestion(n){
    currentSdg = SDGS[Math.floor(Math.random()*17)];
    const display = document.getElementById("quiz-display");
    const grid = document.getElementById("quiz-options");
    
    // MODUS BESTIMMUNG (Einfach vs Schwer)
    let mode = 0; 
    if (n > 4) {
        mode = Math.floor(Math.random() * 3) + 1; 
    }

    // DISPLAY SETUP
    display.style.background = "var(--card-bg)";
    display.style.color = "white";
    display.style.fontSize = "80px";
    display.innerHTML = "";

    if (mode === 0) { // Standard
        display.style.background = currentSdg.farbe; 
        display.innerHTML = `<span>${currentSdg.nr}</span>`;
    } 
    else if (mode === 1) { // Nur Farbe
        display.style.background = currentSdg.farbe;
        display.innerHTML = `<span>?</span>`;
    } 
    else if (mode === 2) { // Nur Zahl
        display.style.background = "#555"; 
        display.innerHTML = `<span>${currentSdg.nr}</span>`;
    } 
    else if (mode === 3) { // Nur Text
        display.style.background = "#222";
        display.style.fontSize = "24px";
        display.style.padding = "20px";
        display.style.textAlign = "center";
        display.innerText = currentSdg.titel;
    }

    // OPTIONEN GENERIEREN
    let opts = [currentSdg];
    while(opts.length < n){
        let r = SDGS[Math.floor(Math.random()*17)];
        if(!opts.find(o => o.nr === r.nr)) opts.push(r);
    }
    
    grid.innerHTML = "";
    opts.sort(()=>Math.random()-0.5).forEach(o=>{
        let b = document.createElement("button"); 
        b.className="option-btn"; 
        b.dataset.nr = o.nr; // Wichtig f√ºr das Finden der L√∂sung

        if (mode === 3) {
            b.innerText = o.nr;
            b.style.backgroundColor = o.farbe;
            b.style.fontSize = "40px";
            b.style.fontWeight = "bold";
        } else {
            b.innerText = o.titel;
            b.style.backgroundColor = "var(--card-bg)";
            b.style.fontSize = "13px";
        }

        b.onclick = () => {
            const isCorrect = o.nr === currentSdg.nr;
            
            if (isCorrect) {
                // --- RICHTIG ---
                // 1. Visuelles Feedback
                if (mode === 3) {
                    b.style.border = "4px solid white";
                    b.style.opacity = "1";
                } else {
                    b.classList.add("correct");
                }
                
                // 2. Alle Buttons sperren (damit man nicht mehr klicken kann)
                const allButtons = grid.querySelectorAll("button");
                allButtons.forEach(btn => btn.disabled = true);

                // 3. Score hoch & N√§chste Frage
                score++;
                document.getElementById("score-label").innerText="Punkte: "+score;
                setTimeout(()=>nextQuizQuestion(n), 1500);

            } else {
                // --- FALSCH ---
                // 1. Leben abziehen
                lives--;
                updateLivesDisplay();

                // 2. Button als falsch markieren und DEAKTIVIEREN
                b.disabled = true; // Dieser Button kann nicht mehr geklickt werden
                
                if (mode === 3) {
                    b.style.opacity = "0.2";
                    b.style.border = "4px solid black";
                } else {
                    b.classList.add("wrong");
                }

                // 3. PR√úFEN OB GAME OVER
                if (lives <= 0) {
                    // Alle Herzen weg -> L√∂sung zeigen & Ende
                    const allButtons = grid.querySelectorAll("button");
                    const correctBtn = Array.from(allButtons).find(btn => parseInt(btn.dataset.nr) === currentSdg.nr);
                    
                    if (correctBtn) {
                        if (mode === 3) {
                            correctBtn.style.border = "4px solid white";
                            correctBtn.style.transform = "scale(1.1)";
                        } else {
                            correctBtn.classList.add("correct");
                        }
                    }

                    // Alle Buttons sperren
                    allButtons.forEach(btn => btn.disabled = true);

                    // Kurz warten, dann Alert und Men√º
                    setTimeout(() => {
                        alert("Spiel vorbei! Keine Herzen mehr.\nDein Score: " + score);
                        showMenu();
                    }, 2000);
                }
                // Wenn lives > 0 passiert hier nichts weiter: 
                // Der Spieler bleibt auf der Seite und muss einen anderen Button klicken.
            }
        };
        grid.appendChild(b);
    });
}

/* --- DRAG & DROP (unver√§ndert) --- */
function startDragDrop(){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById("drag-screen").classList.add("active");
    loadDrag();
}
function loadDrag(){
    currentDragData = [...SDGS].sort(()=>Math.random()-0.5).slice(0,4);
    const zones = document.getElementById("drop-zones");
    const pool = document.getElementById("drag-pool");
    zones.innerHTML = ""; pool.innerHTML = "";
    document.getElementById("check-drag-btn").style.display = "block";
    document.getElementById("check-drag-btn").disabled = false;
    document.getElementById("next-drag-btn").style.display = "none";
    currentDragData.forEach((s, index) => {
        let z = document.createElement("div");
        z.className = "drop-zone";
        z.id = "zone-" + index;
        z.dataset.correctNr = s.nr;
        z.dataset.occupiedBy = "";
        z.innerText = s.titel;
        z.ondragover = e => e.preventDefault();
        z.ondrop = e => handleDrop(z, e.dataTransfer.getData("nr"), e.dataTransfer.getData("color"));
        zones.appendChild(z);
    });
    [...currentDragData].sort(()=>Math.random()-0.5).forEach(s => {
        let box = document.createElement("div");
        box.id = "d" + s.nr;
        box.className = "drag-box";
        box.style.backgroundColor = s.farbe;
        box.innerText = s.nr;
        box.draggable = true;
        box.ondragstart = e => {
            e.dataTransfer.setData("nr", s.nr);
            e.dataTransfer.setData("color", s.farbe);
        };
        box.addEventListener('touchstart', function(e) {
            let touch = e.touches[0];
            box.dataset.startX = touch.clientX;
            box.dataset.startY = touch.clientY;
            box.style.position = 'fixed';
            box.style.zIndex = '1000';
            updatePosition(box, touch);
        }, {passive: false});
        box.addEventListener('touchmove', function(e) {
            e.preventDefault();
            let touch = e.touches[0];
            updatePosition(box, touch);
        }, {passive: false});
        box.addEventListener('touchend', function(e) {
            box.style.display = 'none';
            let touch = e.changedTouches[0];
            let target = document.elementFromPoint(touch.clientX, touch.clientY);
            box.style.display = 'flex';
            box.style.position = 'static';
            let zone = target ? target.closest('.drop-zone') : null;
            if (zone) handleDrop(zone, s.nr, s.farbe);
        });
        pool.appendChild(box);
    });
}
function updatePosition(el, touch) {
    el.style.left = (touch.clientX - 25) + 'px';
    el.style.top = (touch.clientY - 25) + 'px';
}
function handleDrop(zone, nr, color) {
    zone.innerHTML = `<div class="drag-box" style="background:${color}">${nr}</div><small style="margin-top:5px; display:block;">${zone.innerText.split('\n')[0]}</small>`;
    zone.classList.add("filled");
    zone.dataset.occupiedBy = nr;
    const dragItem = document.getElementById("d" + nr);
    if(dragItem) dragItem.remove();
}
function checkDragAssignments() {
    currentDragData.forEach((s, index) => {
        const zone = document.getElementById("zone-" + index);
        const occupied = zone.dataset.occupiedBy;
        if (occupied == zone.dataset.correctNr) zone.classList.add("correct");
        else zone.classList.add("wrong");
    });
    document.getElementById("check-drag-btn").disabled = true;
    document.getElementById("next-drag-btn").style.display = "block";
}

/* --- KARTEIKARTEN (unver√§ndert) --- */
function startFlashcards(){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById("flashcard-screen").classList.add("active");
    cardIdx=0; updateCard();
}
function updateCard(){
    let s=SDGS[cardIdx]; const c=document.getElementById("main-card");
    c.style.background=s.farbe; c.innerHTML=`<h1 style="color:white; font-size:100px">${s.nr}</h1>`;
    document.getElementById("card-progress").innerText=`${cardIdx+1} / 17`; cardFront=true;
}
function flipCard(){
    let s=SDGS[cardIdx]; const c=document.getElementById("main-card");
    if(cardFront){ 
        c.style.background="white"; 
        c.innerHTML=`<img src="${getImgUrl(s.nr)}">`; 
    } else updateCard();
    cardFront=!cardFront;
}
function nextCard(){ cardIdx=(cardIdx+1)%17; updateCard(); }
function prevCard(){ cardIdx=(cardIdx+16)%17; updateCard(); }

/* --- TABELLE (unver√§ndert) --- */
function showTable(){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById("table-screen").classList.add("active");
    const cont = document.getElementById("table-content"); cont.innerHTML = "";
    SDGS.forEach(s=>{
        const row = document.createElement("div"); row.className="list-row";
        row.innerHTML=`<div class="row-nr" style="background:${s.farbe}">${s.nr}</div><img src="${getImgUrl(s.nr)}" class="row-img"><div class="row-text">${s.titel}</div>`;
        cont.appendChild(row);
    });
}
</script>
</body>
</html>
